<script type="text/template" id="play-template">
<%= stylesheet_link_tag "style-live-play.css" %>

<div class="container-fluid container-live-play">
	<div class="row">
    	<div id ="pong-area"  class="col text-center">
      		<h1>Le play pong</h1>
    </div>
	<div class="col chat" id="chat_area">
    </div>
</div>
<script>
var guest_id = 0; // set a change in set_content
var current = <%== current_user.id%>; // >

function save_asking_battle(gid)
{
    var AskForGame = Backbone.Model.extend({
        urlRoot: '/ask_for_games'
    })
    var ask_for_game = new AskForGame();
    ask_for_game.save({ask_for_game:{from_user_id: current, to_user_id: gid, status: 'playing'}});

}
//-------------------------------------------------------------------------//

async function add_to_list(id)
{
    console.log("join list");
    player = new Player({user_id: id});
    await player.save();
    await playercollection.fetch();
    console.log(playercollection);
    listbtnview.setElement("#btn_match_making").render(); 
}

async function  quit_list(id)
{
    console.log("quit list");
    await playercollection.fetch();
    console.log(playercollection);
    var player = playercollection.findWhere({user_id: id});
    console.log(player);
    await Backbone.ajax({
			url: '/players/' + player.id + ".json",
			data: {},
			type: 'DELETE',
			dataType: 'json',
			success: function(response) {
				console.log("Inside success");
                ladderview.render();
			},
			error: function(){
				alert("error");
			}
		});
    console.log(playercollection);
}

//-------------------------------MAIN--------------------------------------//


socket_notif.onmessage = function(event) {// this function check every message, for know if the message is for her, it check the guest params, if the guest params correspond to the curent id the guest it for her  
    const response = event.data;
    const msg = JSON.parse(response);
	    if (msg.type == "ping" || !msg.message)// dont check the ping message
            return ;
        if (msg.message.data.id_guest == current && msg.message.data.play) // read the second for understand this
        {
			// save_asking_battle(msg.message.data.id_host, msg.message.data.ask_id);
			playview.render();
            pongview.setElement("#pong-area").render(); // has the invitation is validate(value play is on true), the host is redirect to the hostview
        }      
};




</script>
</script>