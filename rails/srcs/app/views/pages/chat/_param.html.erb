<script type="text/template" id="chat_param-template">
	<%% console.log(channel_participation) %>
	<div class="param_chat_header">
		<a id="back_to_main_chat" >
			<svg width="2.25em" height="2.25em" viewBox="0 0 16 16" class="bi bi-x-circle-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
				<path fill-rule="evenodd" d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z"/>
	  		</svg>
		</a>
		<h2>Parameter</h2>

	</div>

	<div class="param_chat_body">
			<div class="form-group">
				<button type="button" onclick="ft_leave()" class="btn btn-primary btn-md btn-block btn-dark">Leave the channel</button>
			</div>

			<%% if (channel_participation.is_owner) { %>
		<form>
			<div class="form-group">
				<label for="inputStatus">Change channel status</label>
				<select class="form-control form-control-md" id="updateScope">
					<option>protected</option>
					<option>private</option>
					<option>public</option>
				</select>
			</div>

			<div class="form-group">
				<label for="inputPassword">Password</label>
				<input type="password" id="parameterPassword" class="form-control" aria-describedby="passwordHelpBlock">
				<small id="passwordHelpBlock" class="form-text text-muted">
					Your password must be 8-20 characters long
				</small>
			</div>

			<div class="form-group">
				<button type="submit" onclick="ft_update()" class="btn btn-primary mb-2 btn-dark">Apply</button>
			</div>

		</form>
			<%% } %>
	</div>

	<div class="param_chat_footer">
	</div>
	<script>
		function ft_leave()
		{
			var channel_participation = <%%= JSON.stringify(channel_participation) %>;
			console.log(channel_participation);
			console.log("ft_leave");
			var ChannelParticipation = Backbone.Model.extend({
				urlRoot: '/channel_participations'
			});
			var channel_participation = new ChannelParticipation(channel_participation);
			console.log(channel_participation.toJSON());
			channel_participation.destroy({success: function(){
				console.log("deleted");
				var Notification = Backbone.Model.extend({
					urlRoot: '/notifications'
				});
				var notification = new Notification({
					from_user_id: <%== current_user.id %>,
					user_id: <%== current_user.id %>,
					table_type: "information",
					message: "you left group: " + "<%%= channel.name %>"
				});
				notification.save();
				chatview.render_chat_main();
			}});
		}
		function ft_update()
		{
			var scope = $("#updateScope").val();
			var pwd = $("#parameterPassword").val();
			console.log(scope);
			console.log(pwd);
			if (scope == "protected" && pwd.length == 0)
			{
				alert("a password is needed !");
				return;
			}
			var Channel = Backbone.Model.extend({
				urlRoot: '/channels'
			});
			var channel = new Channel({id:<%%= channel.id %>});//use show of rails controller
			channel.fetch({
				success: function(data){
					data = data.toJSON();
					console.log("got !");
					console.log(data);
					console.log(channel.toJSON());
					channel.set("scope", scope + "-group");
					if (scope == "protected")
						channel.set("password", pwd);
					channel.save();
				}
			});
		}
	</script>
</script>